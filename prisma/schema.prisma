generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url = env("DATABASE_URL")
}

model User {
  id            String         @id @map("_id")
  name          String
  email         String
  emailVerified Boolean        @default(false)
  image         String?
  isAdmin       Boolean        @default(false)
  isBugAdmin    Boolean        @default(false)
  isAboutAdmin  Boolean        @default(false)
  badges        String[]       @default([])
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  sessions      Session[]
  accounts      Account[]
  todos          Todo[]         @relation("TodoOwner")
  assignedTodos  Todo[]         @relation("TodoAssignee")
  completedTodos Todo[]         @relation("TodoCompleter")
  posts          Post[]
  comments      Comment[]
  galleryImages GalleryImage[]
  feedback      Feedback[]
  adventures    Adventure[]

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id @map("_id")
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@index([userId])
  @@map("session")
}

model Account {
  id                    String    @id @map("_id")
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  type                  String?   @default("Oauth")

  @@index([userId])
  @@map("account")
}

model Verification {
  id         String   @id @map("_id")
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([identifier])
  @@map("verification")
}

model Todo {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  title         String
  details       String?
  completed     Boolean   @default(false)
  completedAt   DateTime?
  status        String    @default("todo") // "todo" | "in_progress" | "done"
  recurring     String?   // "daily" | "weekly" | "monthly" | "yearly" | null
  dueDate       DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  userId        String
  user          User      @relation("TodoOwner", fields: [userId], references: [id], onDelete: Cascade)
  assignedToId  String?
  assignedTo    User?     @relation("TodoAssignee", fields: [assignedToId], references: [id], onDelete: SetNull)
  completedById String?
  completedBy   User?     @relation("TodoCompleter", fields: [completedById], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([assignedToId])
  @@index([completedById])
  @@map("todo")
}

model Post {
  id        String      @id @default(auto()) @map("_id") @db.ObjectId
  title     String
  content   String
  slug      String      @unique
  userEmail String
  userId    String?
  user      User?       @relation(fields: [userId], references: [id], onDelete: SetNull)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  images    PostImage[]
  comments  Comment[]

  @@index([userId])
  @@map("post")
}

model PostImage {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  publicId  String   // Cloudinary public ID
  url       String   // Cloudinary secure URL
  width     Int?
  height    Int?
  postId    String   @db.ObjectId
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@map("post_image")
}

model Comment {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  content   String
  postId    String   @db.ObjectId
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  userId    String?
  user      User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([postId])
  @@index([userId])
  @@map("comment")
}

model GalleryImage {
  id               String   @id @default(auto()) @map("_id") @db.ObjectId
  publicId         String   // Cloudinary public ID
  url              String   // Cloudinary secure URL
  width            Int?
  height           Int?
  caption          String?
  description      String?  // Brief description of the photo
  photographerName String?  // Name of the person who took/uploaded the photo
  season           String?  // "spring" | "summer" | "fall" | "winter"
  activity         String?  // "fishing" | "hiking" | "bird_watching" | "camping" | "boating" | "wildlife" | "scenic" | "other"
  userId           String
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([userId])
  @@map("gallery_image")
}

model GuestbookEntry {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  name       String
  message    String
  color      String?  // Optional: Background gradient color (amber, rose, sky, violet, emerald, slate)
  ownerToken String?  // Optional: Token stored in localStorage for ownership verification
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@map("guestbook_entry")
}

model Feedback {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  type        String   // "bug" | "feature"
  title       String
  description String
  status      String   @default("open") // "open" | "in_progress" | "resolved" | "closed"
  userId      String?
  user        User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
  @@index([status])
  @@map("feedback")
}

model SiteSetting {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  key       String   @unique // e.g., "headerImageUrl", "headerImagePublicId"
  value     String
  updatedAt DateTime @updatedAt

  @@map("site_setting")
}

model Adventure {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  title       String
  description String
  address     String
  // Legacy single season (kept for existing records / backward-compat)
  season      String?  // "all" | "spring" | "summer" | "fall" | "winter"
  // New multi-season selection
  seasons     String[] @default([]) // e.g. ["spring","summer"] or ["all"]
  category    String   // "fishing" | "hiking" | "shopping" | "wildlife" | "boating" | "camping" | "swimming" | "other"
  headerImage String   // Cloudinary URL
  headerImagePublicId String // Cloudinary public ID for deletion
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
  @@map("adventure")
}
